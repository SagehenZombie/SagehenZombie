{{#section 'head'}}
    <style>
        #container{margin-left:15%}
        #form{padding:5%}
        #quote{margin:10%;padding:5%}
        #state{font-family: monospace}
    </style>
{{/section}}


<div id="container">
    <div id="form">
            <p>What is your name?</p>
            <input type="text" name="name" id="nm" value="David Oxtoby">
            <p>H or Z?</p>
            <select name="avatar" id="sel">
                <option value="human" selected="true">Sagehen H</option>
                <option value="zombie">Sagehen Z</option>
            </select>
            <img id="demo_img" src="/images/sagehen_front.png">
            <p><button id="ready_button">Ready!</button></p>
            <p id="state"></p>
    </div>
    <div id="players">
        <ul>

        </ul>
    </div>
    <!--
    <div id="quote">
        <ol>
            <li>Organize before they rise!</li>
            <li>They feel no fear, why should you?</li>
            <li>Use your head: cut off theirs.</li>
            <li>Blades don't need reloading.</li>
            <li>Ideal protection = tight clothes, short hair.</li>
            <li>Get up the staircase, then destroy it.</li>
            <li>Get out of the car, get onto the bike.</li>
            <li>Keep moving, keep low, keep quiet, keep alert!</li>
            <li>No place is safe, only safer.</li>
            <li>The zombie may be gone, but the threat lives on.</li>
        </ol>
        <p>--Max Brooks, <i>The Zombie Survival Guide: Complete Protection from the Living Dead</i></p>
    </div>
    -->
</div>

<script src="javascript/jquery.js"></script>
<script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>
<script>
    var ready = false;
window.onload=function(){

    $('#sel').change(function(){
        if($(this).val()=='human'){
            $('#demo_img').attr('src','/images/sagehen_front.png');
        }
        else{
            $('#demo_img').attr('src','/images/zombie_front.png');
        }
    })

    var socket = io.connect('http://localhost:3000');

    socket.on('welcome',function(data){
        $('#state').text('Successfully connected to the server!');
        var players = data.players;
        console.log(players);
        for(i in players){
            $('#players ul').append('<li>'+players[i].avatar+' '+players[i].name+'</li>');
        }
    });

    $('#ready_button').click(function(){
        if(!ready){
            ready = true;
            $(this).text('Waiting');
            $('#state').text('Waiting for more players');
            var name = $('#nm').val();
            var avatar = $('#sel').val();
            socket.emit('connected',{name:name,avatar:avatar});
            $('#players ul').append('<li>'+avatar+' '+name+'</li>');}
    });

    socket.on('countdown',function(){
        seconds = 30;
        $('#state').text('Countdown: '+seconds);
        setInterval(function(){
            seconds--;
            $('#state').text('Countdown: '+seconds);
        },1000)
    });

    socket.on('game start',function(){
        if(!ready){
            $('#ready_button').trigger('click');
        }
        window.location= '/';
    });

    socket.on('newPlayer',function(data){
        newPlayer = data.player;
        $('#players ul').append('<li>'+newPlayer.avatar+' '+newPlayer.name+'</li>');
    })
}

</script>